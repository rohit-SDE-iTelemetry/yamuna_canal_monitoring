{% extends 'utils/base.html' %}
{% block content %}
{% load static %}
<div class="main-panel">
    <div class="content-wrapper">
        <div class="card d-none"
            style="box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;border-radius:10px;">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-9">
                        <h5 class="card-title text-primary"><b><i class="fa-solid fa-file"></i>
                                Reports</b></h5>
                    </div>
                    <div class="col-lg-3">
                        <select class="form-select" onchange="get_report_type(this)">
                            <option selected="" class="d-none" value="">Choose Report Type for stats.</option>
                            <option value="avgerage">Average Report</option>
                            <option value="category">Category Wise Report</option>
                            <option value="frequency">Frequency Wise Report</option>
                            <option value="comparision">Comparision Report</option>
                        </select>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="text-center text-secondary" id="choice-div">
                            <h4>Choose Report Type!</h4>
                        </div>
                        <!-- average report div -->
                        <div id="avg-report" class="d-none">
                            <div class="row">
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Station</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Station</option>
                                        <option>Stn001</option>
                                        <option>Stn002</option>
                                        <option>Stn003</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Average</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Average</option>
                                        <option>1 Min</option>
                                        <option>5 Min</option>
                                        <option>15 Min</option>
                                        <option>1 Day</option>
                                        <option>1 Week</option>
                                        <option>1 Month</option>
                                        <option>1 Year</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="inputPassword4"><b>Date Range</b></label>
                                    <br>
                                    <input type="date" name="" id="">
                                </div>

                                <div class="col-lg-1 text-right">
                                    <br>
                                    <a class="btn btn-sm btn-primary" onclick="fetch_report()"><b>Fetch Report</b></a>
                                </div>
                            </div>
                        </div>
                        <!-- category report div -->
                        <div id="category-report" class="d-none">
                            <div class="row">
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Category</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Category</option>
                                        <option>ARG</option>
                                        <option>AWLR</option>
                                        <option>AWS</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="inputPassword4"><b>Date Range</b></label>
                                    <br>
                                    <input type="date" name="" id="">
                                </div>

                                <div class="col-lg-1 text-right">
                                    <br>
                                    <a class="btn btn-sm btn-primary" onclick="fetch_report()"><b>Fetch Report</b></a>
                                </div>
                            </div>
                        </div>
                        <!-- frequency report div -->
                        <div id="frequency-report" class="d-none">
                            <div class="row">
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Station</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Station</option>
                                        <option>Stn001</option>
                                        <option>Stn002</option>
                                        <option>Stn003</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Frequency</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Frequency</option>
                                        <option>1 Min</option>
                                        <option>5 Min</option>
                                        <option>15 Min</option>
                                        <option>1 Day</option>
                                        <option>1 Week</option>
                                        <option>1 Month</option>
                                        <option>1 Year</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="inputPassword4"><b>Date Range</b></label>
                                    <br>
                                    <input type="date" name="" id="">
                                </div>

                                <div class="col-lg-1 text-right">
                                    <br>
                                    <a class="btn btn-sm btn-primary" onclick="fetch_report()"><b>Fetch Report</b></a>
                                </div>
                            </div>
                        </div>
                        <!-- comparision report div -->
                        <div id="comparision-report" class="d-none">
                            <div class="row">
                                <div class="form-group col-md-3">
                                    <label for="inputPassword4"><b>Station</b></label>
                                    <select id="inputState" class="form-control">
                                        <option selected class="d-none" value="">Choose Stations to compare</option>
                                        <option>Stn001</option>
                                        <option>Stn002</option>
                                        <option>Stn003</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="inputPassword4"><b>Date Range</b></label>
                                    <br>
                                    <input type="date" name="" id="">
                                </div>

                                <div class="col-lg-1 text-right">
                                    <br>
                                    <a class="btn btn-sm btn-primary" onclick="fetch_report()"><b>Fetch Report</b></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="card mt-1 analysis-div"
            style="box-shadow: rgba(60, 64, 67, 0.3) 0px 1px 2px 0px, rgba(60, 64, 67, 0.15) 0px 2px 6px 2px;border-radius:10px;">
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <h5 class="card-title text-primary"><b><i class="fa-solid fa-magnifying-glass-chart"></i>
                                Report Analysis</b></h5>
                    </div>
                    <div class="col-lg-6 text-right">
                        <a href="" class="btn btn-sm btn-info" data-toggle="tooltip" data-placement="top"
                            title="Download report as pdf"><b><i class="fa-solid fa-file-pdf"></i> PDF</b></a>
                        <a href="" class="btn btn-sm btn-info" data-toggle="tooltip" data-placement="top"
                            title="Download report as excel"><b><i class="fa-solid fa-file-excel"></i> Excel</b></a>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <!-- <div class="col-lg-12 d-none" id="report-spinner-div">
                        <div class="text-center">
                            <p><b>Please wait .... fetching data</b></p><br>
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <div class="col-lg-12 m-2" id="">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for=""><strong>Select Station : </strong></label>
                                <select name="" id="station-uuid">
                                    <option value="" class="d-none">choose station for report</option>
                                    {% for site in site_obj %}
                                        <option value="{{site.uuid}}">{{site.name}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <label for=""><strong>From : </strong></label>
                                <input type="date" name="" id="from-dt" value="">
                            </div>
                            <div class="col-lg-3">
                                <label for=""><strong>To : </strong></label>
                                <input type="date" name="" id="to-dt" value="">
                            </div>
                            <div class="col-lg-2">
                                <button type="button" class="btn btn-outline-info" id="generate-report-btn" onclick="generate_report()">Generate Report</button>
                                <button class="btn btn-outline-info d-none" type="button" disabled id="spn1">
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                    Loading Report
                                  </button>
                            </div>
                        </div>
                        <hr>
                    </div>

                    <div class="col-lg-12 d-none" id="report-data-div">
                        <!-- <div class="row flex-grow"> -->
                        <div class="col-md-12">
                            <ul class="nav nav-pills" role="tablist">
                                <li class="nav-item">
                                    <a class="btn btn-sm text-black me-0 nav-link active" data-bs-toggle="pill"
                                        href="#home"><i class="fa fa-table" aria-hidden="true"></i>&nbsp; &nbsp;
                                        Table View</a>
                                </li>
                                <li class="nav-item">
                                    <a class="btn btn-sm text-black me-0 nav-link " data-bs-toggle="pill"
                                        href="#menu1"><i class="fa fa-line-chart" aria-hidden="true"></i>&nbsp; &nbsp;
                                        Graph View</a>
                                </li>
                                <li class="nav-item text-right d-none" id="params-checker">
                                    <div class="form-check form-check-inline">
                                        <label class="form-check-label" for="inlineCheckbox1"><strong>Battery &nbsp;</strong></label>
                                        <input class="form-check-input" type="checkbox" id="bat-param" onclick="update_report_table(this)" checked value="option1">
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <label class="form-check-label" for="inlineCheckbox2"><strong>Water Level &nbsp;</strong></label>
                                        <input class="form-check-input" type="checkbox" id="wl-param" onclick="update_report_table(this)" checked value="option2">
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <label class="form-check-label" for="inlineCheckbox2"><strong>Flow &nbsp;</strong></label>
                                        <input class="form-check-input" type="checkbox" id="fr-param" onclick="update_report_table(this)" checked value="option3">
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <label class="form-check-label" for="inlineCheckbox2"><strong>Gate Opening &nbsp;</strong></label>
                                        <input class="form-check-input" type="checkbox" id="go-param" onclick="update_report_table(this)" checked value="option4">
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <label class="form-check-label" for="inlineCheckbox2"><strong>Velocity &nbsp;</strong></label>
                                        <input class="form-check-input" type="checkbox" id="velocity-param" onclick="update_report_table(this)" checked value="option5">
                                    </div>
                                </li>

                            </ul>
                            <!-- </div>
                            <div class="col-md-2">
                                <a href="#" class="btn btn-primary text-white me-0"><i class="fa fa-download"
                                        aria-hidden="true"></i> Download</a>
                            </div> -->
                        </div>

                        <div class="row flex-grow">
                            <div class="tab-content">
                                <div id="home" class="col-lg-12 grid-margin stretch-card tab-pane active d-none">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="table-responsive pt-3">
                                                <table id="example" class="table table-sm table-bordered"
                                                    style="width:100%">
                                                    <thead class="bg-info">
                                                        <tr>
                                                            <th>TimeStamp</th>
                                                            <th class="bat-param">Battery (v)</th>
                                                            <th class="wl-param">Water Level (m)</th>
                                                            <th class="fr-param">Flow Rate (m/s)</th>
                                                            <th class="go-param">Gate Opening (mm)</th>
                                                            <th class="velocity-param">Velocity (m/s)</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="append2body">
                                                        <!-- <tr>
                                                            <td>28-Dec-2022 10:20</td>
                                                            <td class="bat-param">20</td>
                                                            <td class="wl-param">3</td>
                                                            <td class="fr-param">4</td>
                                                            <td class="go-param">12</td>
                                                            <td class="velocity-param">23</td>
                                                        </tr>
                                                        <tr>
                                                            <td>28-Dec-2022 10:23</td>
                                                            <td class="bat-param">20</td>
                                                            <td class="wl-param">3</td>
                                                            <td class="fr-param">4</td>
                                                            <td class="go-param">12</td>
                                                            <td class="velocity-param">23</td>
                                                        </tr>
                                                        <tr>
                                                            <td>28-Dec-2022 10:25</td>
                                                            <td class="bat-param">20</td>
                                                            <td class="wl-param">3</td>
                                                            <td class="fr-param">4</td>
                                                            <td class="go-param">12</td>
                                                            <td class="velocity-param">23</td>
                                                        </tr> -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div id="menu1" class="col-lg-12 grid-margin stretch-card tab-pane fade"
                                    style="height:20%">
                                    <div class="card card-rounded">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h4 class="card-title card-title-dash">Line chart</h4>
                                                    </div>
                                                    <canvas id="lineChart"></canvas>
                                                    <!-- <img width="100%" height="50%" src="https://www.pngitem.com/pimgs/m/117-1170435_a-line-graph-displays-information-as-a-series.png" alt=""> -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- main-panel ends -->
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css"> 
<script src="{% static 'monitoring_app/js/custom_js/report_js/reports.js' %}"></script>
{% comment %} <script>
    $(document).ready(function () {
        $('#dtBasicExample').DataTable();
        $('.dataTables_length').addClass('bs-select');
    });
</script>
<script>
    $('table').DataTable();
</script> {% endcomment %}

<script>
    function update_report_table(thisTxt){
        var ele = $(thisTxt).attr('id');
        if ($(thisTxt).not(':checked').length) {
            $('.'+ele).hide();
        }else{
            $('.'+ele).show();
        }
    }
    
    
    function generate_report(){
        $('#generate-report-btn').addClass('d-none');
        $('#spn1').removeClass('d-none');
    
        let station_uuid = $('#station-uuid').val().trim();
        let from_dt = $('#from-dt').val().trim();
        let to_dt = $('#to-dt').val().trim();
    
        if(station_uuid == '' || station_uuid.length <= 0){
            alert('select station!');
            $('#generate-report-btn').removeClass('d-none');
            $('#spn1').addClass('d-none');
            return false;
        }
        if(from_dt == '' || from_dt.length <= 0){
            alert('select from date!');
            $('#generate-report-btn').removeClass('d-none');
            $('#spn1').addClass('d-none');
            return false;
        }
        if(to_dt == '' || to_dt.length <= 0){
            alert('select to date!');
            $('#generate-report-btn').removeClass('d-none');
            $('#spn1').addClass('d-none');
            return false;
        }
    
        // ajax call ------ this is for calling reports
        $.ajax({
            type: 'GET',
            url: "/report-filter",
            data: {
                'station_uuid' : station_uuid.trim(),
                'from_dt' : from_dt.trim(),
                'to_dt' : to_dt.trim()
            },
            success: function (response) {
                console.log(response['data_record']);
                let table_str = '';
                for (let reading = 0; reading < response['data_record'].length; reading++) {
                    const element = response['data_record'][reading];
                    table_str = table_str + '<tr>\
                                                <td><strong>'+element['timestamp']+'</strong></td>\
                                                <td class="bat-param">'+element['Battery']+'</td>\
                                                <td class="wl-param">'+element['Waterlevel']+'</td>\
                                                <td class="fr-param">'+element['Flowrate']+'4</td>\
                                                <td class="go-param">'+element['Gateopening']+'</td>\
                                                <td class="velocity-param">'+element['Velocity']+'</td>\
                                            </tr>';
                }
                $('#append2body').html(table_str);
                $('#generate-report-btn').removeClass('d-none');
                $('#spn1').addClass('d-none');
    
                $('#home').removeClass('d-none');
                $('#params-checker').removeClass('d-none');
                $('#report-data-div').removeClass('d-none');
    
                // $('table').DataTable({
                //     "destroy": true,
                // });
    
            }
        });
    
    
    }
</script>
{% endblock content %}